<!DOCTYPE html>
<html lang="en">
<head>
 <!--muhdayin - archive.org-->
 <!--*everyAyah.com*-->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qur'an</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.1/gsap.min.js"></script>
    <!-- GSAP and JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.1/gsap.min.js"></script>
          <script>
        document.addEventListener('DOMContentLoaded', function() {
            const audio = document.getElementById('audio');
            
            // Ensure the media session is supported
            if ('mediaSession' in navigator) {
                // Function to periodically update the media session metadata
                function updateMediaSession() {
                    navigator.mediaSession.metadata = new MediaMetadata({
                        title: document.title,  // Always use the current <title> tag value
                        artist: 'Mishary Alafasy (Indonesian meaning)',             // Empty artist field (can be customized)
                        album: 'everyayah.com, muhdayin (archive.org), tpanurulalim',              // Empty album field (can be customized)
                        artwork: []             // No artwork (can add an image URL here)
                    });
                }

                // Initial media session update
                updateMediaSession();

                // Set interval to update the media session every second (1000ms)
                setInterval(updateMediaSession, 1000);

                // Play action
                navigator.mediaSession.setActionHandler('play', () => {
                    console.log('Play pressed');
                    audio.play();
                });

                // Pause action
                navigator.mediaSession.setActionHandler('pause', () => {
                    console.log('Pause pressed');
                    audio.pause();
                });
            }
        });
    </script>
 <script>
// Function to enter fullscreen on window load
window.onload = function() {
    // Check if fullscreen is available and try to request it
    if (document.documentElement.requestFullscreen) {
        document.documentElement.requestFullscreen();
    } else if (document.documentElement.mozRequestFullScreen) { // Firefox
        document.documentElement.mozRequestFullScreen();
    } else if (document.documentElement.webkitRequestFullscreen) { // Chrome, Safari, Opera
        document.documentElement.webkitRequestFullscreen();
    } else if (document.documentElement.msRequestFullscreen) { // IE/Edge
        document.documentElement.msRequestFullscreen();
    }
};
 </script>

 <script>
  // Get the audio element
const audio = document.getElementById('audio');

// Function to toggle play/pause
function togglePlayPause() {
  if (audio.paused) {
    audio.play();
  } else {
    audio.pause();
  }
}

// Event listener for the spacebar on PC
document.addEventListener('keydown', (event) => {
  // Spacebar keycode or "Space" for better clarity
  if (event.code === 'Space') {
    event.preventDefault();  // Prevent default spacebar behavior (scrolling)
    togglePlayPause();
  }
  
  // If the "OK" button on TV remote is mapped to the "Enter" key
  if (event.code === 'Enter') {
    togglePlayPause();
  }
  
  // In some remote configurations, the "OK" button could map to the "KeyO" or "Enter"
  // You can debug or log event.code to check the correct key code if needed.
});

// Event listener for double-tap on mobile
let lastTap = 0;

document.addEventListener('touchend', (event) => {
  const now = Date.now();
  const diff = now - lastTap;
  
  if (diff < 300 && diff > 0) {
    // Double-tap detected, trigger play/pause
    togglePlayPause();
  }
  lastTap = now;
});

// Optional: Handle "OK" button press (in case the remote sends key events)
document.addEventListener('keydown', (event) => {
  if (event.code === 'Enter') {  // "Enter" can correspond to "OK" on many remotes
    togglePlayPause();
  }
});
 </script>
  <style>
    @font-face {
      font-family: Verdana, Geneva, Arial, sans-serif;

    }

    body {
      font-family: Verdana, Geneva, Arial, sans-serif;
      background-color: white;
      color: black;
      transition: background-color 3s, color 3s;
    }

label[for="chapterSelect"], #chapterSelect { display: none; } label[for="verseSelect"], #verseSelect { display: none; }

    .dark-mode {
      background-color: black;
      color: white;
    }

#verseImageContainer {
  min-height: 200px; /* Set a minimum height to prevent collapsing */
  display: flex; /* Enable flex for alignment */
  justify-content: center; /* Center content horizontally */
  align-items: center; /* Center content vertically */
}

#verseImageContainer img { 
  max-width: 80%; /* Default for wide screens (PC, TV, laptops) */
  margin-top: 10px;  
  margin-left: 10%; /* Centers the image horizontally */
  margin-right: 10%; /* Centers the image horizontally */
  display: block;
  transform: scale(0.95); /* Slightly scaled down for a smoother animation */
  transition: opacity 1s ease-in-out, transform 1s ease-in-out, filter 2s ease-in-out;
}



.dark-mode #verseImageContainer img {
  filter: invert(1); /* Invert colors for dark mode */
  transition: opacity 1s ease-in-out, filter 2s ease-in-out, transform 1s ease-in-out;
}

/* Adjust for tall, narrow screens like 9:16 */
@media screen and (aspect-ratio: 9/16), screen and (max-width: 768px) {
  #verseImageContainer img { 
    max-width: 100%; /* Allow full width for smaller or tall screens */
    height: auto; /* Maintain aspect ratio without cropping */
    margin-left: 0; /* No left margin to avoid cutoff */
    margin-right: 0; /* No right margin to avoid cutoff */
  }
}

/* Adjust for ultra-wide screens (e.g., TVs) */
@media screen and (min-width: 1920px) {
  #verseImageContainer img { 
    max-width: 70%; /* Reduce width further for ultra-wide displays */
    height: auto; /* Maintain aspect ratio */
    margin-left: 15%; /* Add safe margins for overscan */
    margin-right: 15%; /* Add safe margins for overscan */
  }
}




    #darkModeToggle {
      position: fixed;
      top: 550px;
      left: 10px;
      padding: 10px 20px;
      background-color: gray;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
      border-radius: 5px;
    }

    .dark-mode #darkModeToggle {
      background-color: #333;
      color: white;
    }

    #darkModeToggle i {
      font-size: 20px;
    }

#report {
  font-family: 'Inter', sans-serif;  /* Specify Inter font */
  font-size: 24px;
  font-weight: bold;
  height: 100%; /* Reduce height by 10% */
  position: absolute; /* Position the element relative to its nearest positioned ancestor */
  top: 0%; /* Start 10% from the top */
  left: 5%; /* Start 10% from the left */
  max-width: 80%; /* Ensure content fits on zoomed screens */
  margin-right: 10%; /* Safe margin to avoid cutoff on zoomed TVs */
  margin-left: 0; /* No extra margin on the left since it's already defined */
  transition: opacity 1s ease-in-out, filter 2s ease-in-out;
}




#audio {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    border-radius: 0;
    background: none;
    outline: none;
    appearance: none;
    padding: 0;
    opacity: 0.1;
}

/* Detect light mode and change the color */
@media (prefers-color-scheme: light) {
    #audio {
    opacity: 1;
    }
}



.translation {
  margin-top: 10px;
  font-size: 1.2em;
  color: #000000;
  padding: 10px;
  border-top: 1px solid #ddd;
  max-width: 80%; /* Reduce max-width to ensure content fits on zoomed screens */
  margin-right: 10%; /* Safe margin to avoid cutoff on zoomed TVs */
  margin-left: 10%;  /* Safe margin for left alignment */
  transition: opacity 1s ease-in-out, filter 2s ease-in-out;
}

.dark-mode .translation {
  color: #FFFFFF;
  margin-right: 10%; /* Same safe margin for zoomed TVs */
  margin-left: 10%;  /* Same safe margin for zoomed TVs */
  transition: opacity 1s ease-in-out, filter 2s ease-in-out;
}

#translation {
  margin-top: 10px;
  font-size: 1.2em;
  padding: 10px;
  border-top: 1px solid #ddd;
  margin-right: 10%; /* Same safe margin */
  margin-left: 10%;  /* Same safe margin */
}

    body {
      transition: background-color 0.3s, color 0.3s; /* Smooth transition */
    }

    /* Dark mode styles */
    .dark-mode {
      background-color: #333;
      color: white;
    }

        #fullscreenBtn {
            position: absolute;
            top: 3%;
            right: 4%;
            font-size: 12px; /* Icon size */
            background-color: #45a049;  /* Green background */
            opacity: 0.1;
            color: white;               /* White text */
            padding: 5px 10px;          /* Padding */
            border: none;               /* No border */
            border-radius: 7px;         /* Rounded corners */
            cursor: pointer;            /* Pointer cursor on hover */
            z-index: 1000;              /* Make sure it's above other content */
        }

        /* Button hover effect */
        #fullscreenBtn:hover {
            background-color: black;  /* Darker green on hover */
        }

        /* Fullscreen button when in fullscreen mode */
        #fullscreenBtn.fullscreen {
            background-color: black;  /* Change background to black when in fullscreen */
            opacity: 1;  /* Make the button more visible */
        }

        /* Fullscreen button hover effect when in fullscreen mode */
        #fullscreenBtn.fullscreen:hover {
            background-color: #45a049;  /* Green background on hover in fullscreen */
        }


  </style>
</head>

<body>

  <button id="darkModeToggle">
    <i class="fas fa-sun"></i> <!-- Sun icon for light mode -->
    <i class="fas fa-moon" style="display: none;"></i> <!-- Moon icon for dark mode -->
  </button>

     <button id="fullscreenBtn">
        <i class="fas fa-expand"></i> Fullscreen
    </button>

    <script>
        // Get the fullscreen button
        const fullscreenBtn = document.getElementById("fullscreenBtn");

        // Function to check if the document is in fullscreen mode
        function updateFullscreenButton() {
            if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i> ';
            } else {
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i> ';
            }
        }

        // Add an event listener for the fullscreenchange event
        document.addEventListener("fullscreenchange", updateFullscreenButton);
        document.addEventListener("webkitfullscreenchange", updateFullscreenButton); // Safari
        document.addEventListener("mozfullscreenchange", updateFullscreenButton); // Firefox
        document.addEventListener("MSFullscreenChange", updateFullscreenButton); // IE/Edge

        // Add an event listener for the button click
        fullscreenBtn.addEventListener("click", function() {
            if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
                // Enter fullscreen
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) { // Firefox
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) { // Chrome/Safari
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) { // IE/Edge
                    document.documentElement.msRequestFullscreen();
                }
            } else {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen(); // Firefox
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen(); // Chrome/Safari
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen(); // IE/Edge
                }
            }
        });

        // Initialize button state on page load
        updateFullscreenButton();
    </script>
  <h1></h1>

  <!-- Chapter Selector -->
  <label for="chapterSelect"></label>
  <select id="chapterSelect" onchange="loadAudio()">
    <option value="">SURAH</option>
  </select>

  <br>

  <!-- Verse Selector -->
  <label for="verseSelect"></label>
  <select id="verseSelect" onchange="seekToSelectedVerse()">
    <option value="">AYAT</option>
  </select>

  <br>

  <!-- Verse Image -->
  <div id="verseImageContainer"></div>

  <!-- Translation -->
  <div id="translation" class="translation"></div>

  <!-- Audio Box -->
  <audio id="audio" controls>
    <source id="audioSource" type="audio/mp3">
    Your browser does not support the audio element.
  </audio>

  <!-- Report -->
  <div id="report"></div>


<script>
const toggleButton = document.getElementById('darkModeToggle');
const sunIcon = toggleButton.querySelector('.fa-sun');
const moonIcon = toggleButton.querySelector('.fa-moon');

// Function to force dark mode based on system preference and fragment identifier
function forceDarkMode() {
  const fragment = window.location.hash;
  if (fragment === "#0") {
    document.body.classList.add('light-mode'); 
    sunIcon.style.display = 'none'; 
    moonIcon.style.display = 'inline-block'; 
  } else {
    document.body.classList.add('dark-mode');
    sunIcon.style.display = 'none';
    moonIcon.style.display = 'none'; 
  }
}
forceDarkMode();

toggleButton.addEventListener('click', () => {
  const isDarkMode = document.body.classList.contains('dark-mode');
  if (!isDarkMode) {
    document.body.classList.remove('dark-mode');
    document.body.classList.add('light-mode');
    sunIcon.style.display = 'none';
    moonIcon.style.display = 'inline-block';
  }
});

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', forceDarkMode);

let jsonData = null;
let translationData = null;
let currentChapterData = null;
let currentChapterIndex = 0;

// Fetch JSON data for chapters (2TM.json)
fetch('https://muslim1446.github.io/a/2TM.json')
  .then(response => response.json())
  .then(data => {
    jsonData = data;
    populateChapterSelect();
    checkUrlParams(); // Check URL params for Surah and Ayat
  })
  .catch(error => console.error('Error fetching JSON:', error));

// Fetch translation data (3TM.json)
fetch('https://muslim1446.github.io/a/3TM.json')
  .then(response => response.json())
  .then(data => {
    translationData = data;
  })
  .catch(error => console.error('Error fetching translation JSON:', error));

function populateChapterSelect() {
  const chapterSelect = document.getElementById('chapterSelect');
  jsonData.chapters.forEach((chapter, index) => {
    const option = document.createElement('option');
    option.value = index;
    option.textContent = ` (${chapter.chapterNumber}) ${chapter.title} `;
    chapterSelect.appendChild(option);
  });
}

function checkUrlParams() {
  const urlParams = new URLSearchParams(window.location.search);
  const surah = urlParams.get('surah');
  const ayat = urlParams.get('ayat');

  if (surah) {
    document.getElementById('chapterSelect').value = surah - 1;
    loadChapterAudio(surah - 1); // Adjusting for 1-based index
  }

  if (ayat) {
    const verseSelect = document.getElementById('verseSelect');
    verseSelect.value = ayat;
    seekToSelectedVerse();
  }

  const fragment = window.location.hash;
  if (fragment === "#0") {
    document.body.classList.add('light-mode');
  }
}

function loadAudio() {
  const chapterSelect = document.getElementById('chapterSelect');
  const selectedChapterIndex = chapterSelect.value;

  if (selectedChapterIndex !== "") {
    loadChapterAudio(selectedChapterIndex);
  }
}

function loadChapterAudio(index) {
  const chapter = jsonData.chapters[index];
  const audioSource = document.getElementById('audioSource');
  audioSource.src = chapter.audioURL;
  
  const audioPlayer = document.getElementById('audio');
  audioPlayer.load(); // Begin loading metadata
  audioPlayer.play();

  currentChapterData = chapter;
  currentChapterIndex = index;
  updateVerseSelect();

  // Show the first verse image and translation right after the audio starts
  audioPlayer.addEventListener('canplaythrough', () => {
    displayVersePNG(chapter.chapterNumber, 1);  // Show the first verse image
    displayTranslation(chapter.chapterNumber, 1);  // Show translation for the first verse
  });

  // Save the chapter and ayat in localStorage
  localStorage.setItem('currentChapterIndex', index);
  localStorage.setItem('currentAyatIndex', 1); // Default to 1 for now
}

function updateVerseSelect() {
  const verseSelect = document.getElementById('verseSelect');
  verseSelect.innerHTML = '<option value="">-AYAT</option>';

  if (currentChapterData) {
    currentChapterData.verses.forEach(verse => {
      const option = document.createElement('option');
      option.value = verse.verseNumber;
      option.textContent = `Ayat ${verse.verseNumber}`;
      verseSelect.appendChild(option);
    });
  }
}

function displayVersePNG(chapNum, verseNum) {
  const verseImageContainer = document.getElementById('verseImageContainer');
  verseImageContainer.innerHTML = ''; // Clear any existing images

  const arabicImg = document.createElement('img');
  arabicImg.src = `https://everyayah.com/data/quranpngs/${chapNum}_${verseNum}.png`;
  arabicImg.alt = `Arabic Verse ${verseNum}`;
  verseImageContainer.appendChild(arabicImg);
}

function displayTranslation(chapNum, verseNum) {
  const translationContainer = document.getElementById('translation');
  translationContainer.innerHTML = ''; // Clear existing translation

  if (translationData && translationData[chapNum]) {
    const translation = translationData[chapNum].data_ayat.data.find(item => item.aya_number === verseNum);
    if (translation) {
      const translationText = document.createElement('div');
      translationText.textContent = translation.translation_aya_text;
      translationContainer.appendChild(translationText);
    }
  }
}

function updateRealTimeReport() {
  const audio = document.getElementById('audio');
  const currentTime = audio.currentTime;

  if (currentChapterData) {
    currentChapterData.verses.forEach(verse => {
      const startTimeParts = verse.startTime.split(':').map(Number);
      const endTimeParts = verse.endTime.split(':').map(Number);

      const startTotalSeconds = startTimeParts[0] * 3600 + startTimeParts[1] * 60 + startTimeParts[2];
      const endTotalSeconds = endTimeParts[0] * 3600 + endTimeParts[1] * 60 + endTimeParts[2];

      if (currentTime >= startTotalSeconds && currentTime <= endTotalSeconds) {
        const reportDiv = document.getElementById('report');
        const reportText = `
          <strong></strong><br>
          Surah ${currentChapterData.title} (${currentChapterData.chapterNumber}) | Ayat ${verse.verseNumber}<br>
          <strong style="font-size: 53%;">${verse.startTime}</strong>
        `;
        reportDiv.innerHTML = reportText;
        displayVersePNG(currentChapterData.chapterNumber, verse.verseNumber);  // Update the verse image
        displayTranslation(currentChapterData.chapterNumber, verse.verseNumber);  // Update translation
      }
    });
  }
}

function seekToSelectedVerse() {
  const verseSelect = document.getElementById('verseSelect');
  const verseNum = verseSelect.value;

  if (verseNum !== "") {
    const verseData = currentChapterData.verses.find(v => v.verseNumber == verseNum);
    if (verseData) {
      const audio = document.getElementById('audio');
      const startTimeParts = verseData.startTime.split(':').map(Number);
      const startTotalSeconds = startTimeParts[0] * 3600 + startTimeParts[1] * 60 + startTimeParts[2];
      audio.currentTime = startTotalSeconds;
      
      // Save the selected Ayat in localStorage
      localStorage.setItem('currentAyatIndex', verseNum);
    }
  }
}

// Add event listener for audio playing
document.getElementById('audio').addEventListener('timeupdate', updateRealTimeReport);

// Automatically go to the next Surah when the current one finishes
document.getElementById('audio').addEventListener('ended', function() {
  if (currentChapterIndex < jsonData.chapters.length - 1) {
    currentChapterIndex++; 
    loadChapterAudio(currentChapterIndex); 
  } else {
    alert('You have reached the last chapter.');
  }
});

// Retrieve stored Surah and Ayat on page load
window.onload = function() {
  alert("Audio loading takes less than a minute for the fastest connection.");

  const storedChapterIndex = localStorage.getItem('currentChapterIndex');
  const storedAyatIndex = localStorage.getItem('currentAyatIndex');

  if (storedChapterIndex && storedAyatIndex) {
    document.getElementById('chapterSelect').value = storedChapterIndex;
    loadChapterAudio(storedChapterIndex);
    document.getElementById('verseSelect').value = storedAyatIndex;
    seekToSelectedVerse();
  }
}

 // Title update function
function updateTitle() {
  const audio = document.getElementById('audio');
  const currentTime = audio.currentTime;

  // Find the current verse based on the currentTime of the audio
  if (currentChapterData) {
    const currentVerse = currentChapterData.verses.find(verse => {
      const startTimeParts = verse.startTime.split(':').map(Number);
      const endTimeParts = verse.endTime.split(':').map(Number);

      const startTotalSeconds = startTimeParts[0] * 3600 + startTimeParts[1] * 60 + startTimeParts[2];
      const endTotalSeconds = endTimeParts[0] * 3600 + endTimeParts[1] * 60 + endTimeParts[2];

      return currentTime >= startTotalSeconds && currentTime <= endTotalSeconds;
    });

    if (currentVerse) {
      document.title = `Surah ${currentChapterData.title} - ${currentVerse.verseNumber}`;
    }
  }
}

// Call updateTitle every second (1000 milliseconds)
setInterval(updateTitle, 1000);
</script>

</body>
</html>
