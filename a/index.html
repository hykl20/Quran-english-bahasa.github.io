<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qur'an</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic&display=swap" rel="stylesheet">
  <style>
    #audio {
      display: none; /* Hide the native audio player */
    }
    @font-face {
    font-family: 'Verdana';
    font-weight: 400;
    src: local('Verdana'), url('https://muslim1446.github.io/a/verdana.ttf') format('tff');
}

    body { font-family: Verdana, Geneva, Arial, sans-serif; background-color: white; color: black; transition: background-color 3s, color 3s; } .chapterSelect, .verseSelect { font-family: 'Noto Sans Arabic', sans-serif; padding: 12px; background-color: #f0f0f0; border: 1px solid #ccc; font-size: 16px; border-radius: 8px; /* Slightly less rounded */ width: 100%; direction: rtl; /* For right-to-left alignment for Arabic text */ } .parentContainer { display: flex; flex-direction: column; align-items: flex-start; width: 50%; /* Adjust as needed */ margin: 0 auto; /* Center the container */ margin-left: 10%; /* Start from the left with 10% margin */ } label { font-size: 18px; margin-bottom: 5px; } .dark-mode { background-color: black; color: white; } #verseImageContainer { min-height: 200px; /* Set a minimum height to prevent collapsing */ display: flex; /* Enable flex for alignment */ justify-content: center; /* Center content horizontally */ align-items: center; /* Center content vertically */ } #verseImageContainer img { max-width: 80%; /* Default for wide screens (PC, TV, laptops) */ margin-top: 10px; margin-left: 10%; /* Centers the image horizontally */ margin-right: 10%; /* Centers the image horizontally */ display: block; transform: scale(0.95); /* Slightly scaled down for a smoother animation */ transition: opacity 1s ease-in-out, transform 1s ease-in-out, filter 2s ease-in-out; } .dark-mode #verseImageContainer img { filter: invert(1); /* Invert colors for dark mode */ transition: opacity 1s ease-in-out, filter 2s ease-in-out, transform 1s ease-in-out; } /* Adjust for tall, narrow screens like 9:16 */ @media screen and (aspect-ratio: 9/16), screen and (max-width: 768px) { #verseImageContainer img { max-width: 100%; /* Allow full width for smaller or tall screens */ height: auto; /* Maintain aspect ratio without cropping */ margin-left: 0; /* No left margin to avoid cutoff */ margin-right: 0; /* No right margin to avoid cutoff */ } } /* Adjust for ultra-wide screens (e.g., TVs) */ @media screen and (min-width: 1920px) { #verseImageContainer img { max-width: 70%; /* Reduce width further for ultra-wide displays */ height: auto; /* Maintain aspect ratio */ margin-left: 15%; /* Add safe margins for overscan */ margin-right: 15%; /* Add safe margins for overscan */ } } #darkModeToggle { position: fixed; top: 550px; left: 10px; padding: 10px 20px; background-color: gray; color: white; border: none; cursor: pointer; font-size: 16px; border-radius: 5px; } .dark-mode #darkModeToggle { background-color: #333; color: white; } #darkModeToggle i { font-size: 20px; } #report { font-family: 'Inter', sans-serif;  /* Specify Inter font */ font-size: 19px; font-weight: bold; height: 100%; /* Reduce height by 10% */ position: absolute; /* Position the element relative to its nearest positioned ancestor */ top: 0%; /* Start 10% from the top */ right: 5%; /* Start 10% from the left */ max-width: 80%; /* Ensure content fits on zoomed screens */ margin-right: 10%; /* Safe margin to avoid cutoff on zoomed TVs */ margin-left: 0; /* No extra margin on the left since it's already defined */ transition: opacity 1s ease-in-out, filter 2s ease-in-out; } #rraudio { position: absolute; /* or fixed if you want it to stay fixed */ bottom: 0; /* Align to the bottom */ left: 0; /* Align to the left edge */ width: 100%; /* Full width */ border-radius: 0; /* Remove any rounded corners */ background: none; /* Optional: removes any background */ outline: none; /* Optional: removes any outline for focus */ appearance: none; /* Optional: removes default styling */ padding: 0; /* Optional: removes default padding */ } .translation { margin-top: 10px; font-size: 1.2em; color: #000000; padding: 10px; border-top: 1px solid #ddd; max-width: 80%; /* Reduce max-width to ensure content fits on zoomed screens */ margin-right: 10%; /* Safe margin to avoid cutoff on zoomed TVs */ margin-left: 10%;  /* Safe margin for left alignment */ transition: opacity 1s ease-in-out, filter 2s ease-in-out; } .dark-mode .translation { color: #FFFFFF; margin-right: 10%; /* Same safe margin for zoomed TVs */ margin-left: 10%;  /* Same safe margin for zoomed TVs */ transition: opacity 1s ease-in-out, filter 2s ease-in-out; } #translation { margin-top: 10px; font-size: 1.2em; padding: 10px; border-top: 1px solid #ddd; margin-right: 10%; /* Same safe margin */ margin-left: 10%;  /* Same safe margin */ } body { transition: background-color 0.3s, color 0.3s; /* Smooth transition */ } /* Dark mode styles */ .dark-mode { background-color: #333; color: white; } 
  #f4f4f4;
    }
    #audio {
      display: none; /* Hide the native audio player */
    }
    #play-pause {
      position: absolute;
      bottom: 0;
      left: 0;
      padding: 15px 20px;
      font-size: 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #play-pause:hover {
      background-color: #0056b3;
    }
  </style>
</head>

<body>

  <button id="darkModeToggle">
    <i class="fas fa-sun"></i> <!-- Sun icon for light mode -->
    <i class="fas fa-moon" style="display: none;"></i> <!-- Moon icon for dark mode -->
  </button>

  <h1></h1>
  <div class="parentContainer">
    <label for="chapterSelect"></label>
    <select id="chapterSelect" onchange="loadAudio()">
      <option value="">SURAH</option>
    </select>

    <br>

    <label for="verseSelect"></label>
    <select id="verseSelect" onchange="seekToSelectedVerse()">
      <option value="">AYAT</option>
    </select>
  </div>

  <br>

  <div id="verseImageContainer"></div>

  <div id="translation" class="translation"></div>
<div id="audio-container" class="loading">
  <div id="loading"></div>
  <audio id="audio" controls>
    <source id="audioSource" type="audio/mp3">
    Your browser does not support the audio element.
  </audio>
</div>
  <button id="play-pause" class="fa fa-play"></button>

  <script>
    const audio = document.getElementById('audio');
    const playPauseButton = document.getElementById('play-pause');

    playPauseButton.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        playPauseButton.classList.remove('fa-play');
        playPauseButton.classList.add('fa-pause');
      } else {
        audio.pause();
        playPauseButton.classList.remove('fa-pause');
        playPauseButton.classList.add('fa-play');
      }
    });
  </script>

  <div id="report"></div>

<script>
const toggleButton = document.getElementById('darkModeToggle');
const sunIcon = toggleButton.querySelector('.fa-sun');
const moonIcon = toggleButton.querySelector('.fa-moon');

// Function to force dark mode based on system preference and fragment identifier
function forceDarkMode() {
  const fragment = window.location.hash;
  if (fragment === "#0") {
    document.body.classList.add('light-mode'); 
    sunIcon.style.display = 'none'; 
    moonIcon.style.display = 'inline-block'; 
  } else {
    document.body.classList.add('dark-mode');
    sunIcon.style.display = 'none';
    moonIcon.style.display = 'none'; 
  }
}
forceDarkMode();

toggleButton.addEventListener('click', () => {
  const isDarkMode = document.body.classList.contains('dark-mode');
  if (!isDarkMode) {
    document.body.classList.remove('dark-mode');
    document.body.classList.add('light-mode');
    sunIcon.style.display = 'none';
    moonIcon.style.display = 'inline-block';
  }
});

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', forceDarkMode);

let jsonData = null;
let translationData = null;
let currentChapterData = null;
let currentChapterIndex = 0;

// Fetch JSON data for chapters (2TM.json)
fetch('https://muslim1446.github.io/a/2TM.json')
  .then(response => response.json())
  .then(data => {
    jsonData = data;
    populateChapterSelect();
    checkUrlParams(); // Check URL params for Surah and Ayat
  })
  .catch(error => console.error('Error fetching JSON:', error));

// Fetch translation data (3TM.json)
fetch('https://muslim1446.github.io/a/3TM.json')
  .then(response => response.json())
  .then(data => {
    translationData = data;
  })
  .catch(error => console.error('Error fetching translation JSON:', error));

function populateChapterSelect() {
  const chapterSelect = document.getElementById('chapterSelect');
  jsonData.chapters.forEach((chapter, index) => {
    const option = document.createElement('option');
    option.value = index;
    option.textContent = ` (${chapter.chapterNumber}) ${chapter.title} `;
    chapterSelect.appendChild(option);
  });
}

function checkUrlParams() {
  const urlParams = new URLSearchParams(window.location.search);
  const surah = urlParams.get('surah');
  const ayat = urlParams.get('ayat');

  if (surah) {
    document.getElementById('chapterSelect').value = surah - 1;
    loadChapterAudio(surah - 1); // Adjusting for 1-based index
  }

  if (ayat) {
    const verseSelect = document.getElementById('verseSelect');
    verseSelect.value = ayat;
    seekToSelectedVerse();
  }

  const fragment = window.location.hash;
  if (fragment === "#0") {
    document.body.classList.add('light-mode');
  }
}

function loadAudio() {
  const chapterSelect = document.getElementById('chapterSelect');
  const selectedChapterIndex = chapterSelect.value;

  if (selectedChapterIndex !== "") {
    loadChapterAudio(selectedChapterIndex);
  }
}

function loadChapterAudio(index) {
  const chapter = jsonData.chapters[index];
  const audioSource = document.getElementById('audioSource');
  audioSource.src = chapter.audioURL;
  
  const audioPlayer = document.getElementById('audio');
  audioPlayer.load(); // Begin loading metadata
  audioPlayer.play();

  currentChapterData = chapter;
  currentChapterIndex = index;
  updateVerseSelect();

  // Show the first verse image and translation right after the audio starts
  audioPlayer.addEventListener('canplaythrough', () => {
    displayVersePNG(chapter.chapterNumber, 1);  // Show the first verse image
    displayTranslation(chapter.chapterNumber, 1);  // Show translation for the first verse
  });

  // Save the chapter and ayat in localStorage
  localStorage.setItem('currentChapterIndex', index);
  localStorage.setItem('currentAyatIndex', 1); // Default to 1 for now
}

function updateVerseSelect() {
  const verseSelect = document.getElementById('verseSelect');
  verseSelect.innerHTML = '<option value="">-AYAT</option>';

  if (currentChapterData) {
    currentChapterData.verses.forEach(verse => {
      const option = document.createElement('option');
      option.value = verse.verseNumber;
      option.textContent = `Ayat ${verse.verseNumber}`;
      verseSelect.appendChild(option);
    });
  }
}

function displayVersePNG(chapNum, verseNum) {
  const verseImageContainer = document.getElementById('verseImageContainer');
  verseImageContainer.innerHTML = ''; // Clear any existing images

  const arabicImg = document.createElement('img');
  arabicImg.src = `https://everyayah.com/data/quranpngs/${chapNum}_${verseNum}.png`;
  arabicImg.alt = `Arabic Verse ${verseNum}`;
  verseImageContainer.appendChild(arabicImg);
}

function displayTranslation(chapNum, verseNum) {
  const translationContainer = document.getElementById('translation');
  translationContainer.innerHTML = ''; // Clear existing translation

  if (translationData && translationData[chapNum]) {
    const translation = translationData[chapNum].data_ayat.data.find(item => item.aya_number === verseNum);
    if (translation) {
      const translationText = document.createElement('div');
      translationText.textContent = translation.translation_aya_text;
      translationContainer.appendChild(translationText);
    }
  }
}

function updateRealTimeReport() {
  const audio = document.getElementById('audio');
  const currentTime = audio.currentTime;

  if (currentChapterData) {
    currentChapterData.verses.forEach(verse => {
      const startTimeParts = verse.startTime.split(':').map(Number);
      const endTimeParts = verse.endTime.split(':').map(Number);

      const startTotalSeconds = startTimeParts[0] * 3600 + startTimeParts[1] * 60 + startTimeParts[2];
      const endTotalSeconds = endTimeParts[0] * 3600 + endTimeParts[1] * 60 + endTimeParts[2];

      if (currentTime >= startTotalSeconds && currentTime <= endTotalSeconds) {
        const reportDiv = document.getElementById('report');
        const reportText = `
          <strong></strong><br>
          Surah ${currentChapterData.title} (${currentChapterData.chapterNumber}) | Ayat ${verse.verseNumber}<br>
          <strong style="font-size: 50%;">${verse.startTime}</strong>
        `;
        reportDiv.innerHTML = reportText;
        displayVersePNG(currentChapterData.chapterNumber, verse.verseNumber);  // Update the verse image
        displayTranslation(currentChapterData.chapterNumber, verse.verseNumber);  // Update translation
      }
    });
  }
}

function seekToSelectedVerse() {
  const verseSelect = document.getElementById('verseSelect');
  const verseNum = verseSelect.value;

  if (verseNum !== "") {
    const verseData = currentChapterData.verses.find(v => v.verseNumber == verseNum);
    if (verseData) {
      const audio = document.getElementById('audio');
      const startTimeParts = verseData.startTime.split(':').map(Number);
      const startTotalSeconds = startTimeParts[0] * 3600 + startTimeParts[1] * 60 + startTimeParts[2];
      audio.currentTime = startTotalSeconds;
      
      // Save the selected Ayat in localStorage
      localStorage.setItem('currentAyatIndex', verseNum);
    }
  }
}

// Add event listener for audio playing
document.getElementById('audio').addEventListener('timeupdate', updateRealTimeReport);

// Automatically go to the next Surah when the current one finishes
document.getElementById('audio').addEventListener('ended', function() {
  if (currentChapterIndex < jsonData.chapters.length - 1) {
    currentChapterIndex++; 
    loadChapterAudio(currentChapterIndex); 
  } else {
    alert('You have reached the last chapter.');
  }
});

// Retrieve stored Surah and Ayat on page load
window.onload = function() {
  alert("Audio loading takes less than a minute for the fastest connection.");

  const storedChapterIndex = localStorage.getItem('currentChapterIndex');
  const storedAyatIndex = localStorage.getItem('currentAyatIndex');

  if (storedChapterIndex && storedAyatIndex) {
    document.getElementById('chapterSelect').value = storedChapterIndex;
    loadChapterAudio(storedChapterIndex);
    document.getElementById('verseSelect').value = storedAyatIndex;
    seekToSelectedVerse();
  }
}
</script>




</body>
</html>
